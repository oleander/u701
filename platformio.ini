; PlatformIO Project Configuration File
;
; Please visit documentation for options and examples
; https://docs.platformio.org/page/projectconf.html
[custom]
esp_wifi_password = ${sysenv.ESP_WIFI_PASSWORD}
esp_ota_password = ${sysenv.ESP_OTA_PASSWORD}
esp_wifi_ssid = ${sysenv.ESP_WIFI_SSID}
home_wifi_password = ${sysenv.HOME_WIFI_PASSWORD}
home_wifi_ssid = ${sysenv.HOME_WIFI_SSID}

[platformio]
default_envs = debug

[env]
extra_scripts =
    pre:tools/platformio.git.py
    pre:tools/platformio.patch.py
    tools/platformio.cargo.py
board = esp32-c3-devkitm-1
platform = espressif32
framework = arduino
upload_speed = 921600
rust_lib = u701
rust_target = riscv32imc-esp-espidf
build_flags =
    '-D ESP_WIFI_SSID="${sysenv.ESP_WIFI_SSID}"'
    '-D ESP_WIFI_PASSWORD="${sysenv.ESP_WIFI_PASSWORD}"'
    '-D ESP_OTA_PASSWORD="${sysenv.ESP_OTA_PASSWORD}"'
    -DUSE_NIMBLE
monitor_port = /dev/tty.*
upload_port = /dev/tty.*

lib_deps =
    https://github.com/oleander/ESP32-BLE-Keyboard.git
    h2zero/NimBLE-Arduino
    thijse/ArduinoLog

[env:ota]
extends = env:release
upload_flags = --auth=${custom.esp_ota_password}
upload_port = 192.168.4.1
upload_protocol = espota
extra_scripts = ${env.extra_scripts} post:tools/restore_home_wifi.py

[env:debug]
build_type = debug
build_flags =
    ${env.build_flags}
    -Os

[env:release]
build_flags =
    ${env.build_flags}
    -fuse-linker-plugin
    -Wl,--gc-sections
    -Os
build_type = release
