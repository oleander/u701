; PlatformIO Project Configuration File
;
; Please visit documentation for options and examples
; https://docs.platformio.org/page/projectconf.html
[custom]
esp_wifi_password = ${sysenv.ESP_WIFI_PASSWORD}
esp_ota_password = ${sysenv.ESP_OTA_PASSWORD}
esp_wifi_ssid = ${sysenv.ESP_WIFI_SSID}
home_wifi_password = ${sysenv.HOME_WIFI_PASSWORD}
home_wifi_ssid = ${sysenv.HOME_WIFI_SSID}

[platformio]
default_envs = esp32c3

[env]
extra_scripts =
    pre:tools/platformio.patch.py
    pre:tools/platformio.git.py
    tools/platformio.cargo.py

build_flags =
    '-D ESP_WIFI_PASSWORD="${sysenv.ESP_WIFI_PASSWORD}"'
    '-D ESP_OTA_PASSWORD="${sysenv.ESP_OTA_PASSWORD}"'
    '-D ESP_WIFI_SSID="${sysenv.ESP_WIFI_SSID}"'
    -w
    -Os

rust_lib = u701
framework = arduino
board_build.partitions = partitions.csv

monitor_port = "${env.upload_port}"

upload_port = "/dev/cu.wchusbserial110"
upload_speed = 921600

lib_deps =
    thijse/ArduinoLog
    mathertel/OneButton

[env:nrf]
rust_target = thumbv7em-none-eabihf
board = adafruit_feather_nrf52832
board_build.f_cpu = 64000000L
board_build.mcu = nrf52832
platform = nordicnrf52

[env:esp32c3]
rust_target = riscv32imc-esp-espidf
platform = espressif32
; board_build.mcu = esp32c3
board = esp32-c3-devkitm-1
framework = 
    ${env.framework}
    espidf

[env:esp32]
rust_target = xtensa-esp32-espidf
platform = espressif32
board = esp32dev
framework = 
    ${env.framework}
    espidf

[env:debug]
extends = env:esp32c3
build_type = debug

[env:release]
extends = env:esp32c3
board_build.partitions = partitions.csv
build_flags = 
    ${env.build_flags}
    -Wall
    -Os
build_type = release

[env:ota]
extends = env:release
extra_scripts = 
    ${env.extra_scripts}
    post:tools/platform.wifi.py
upload_port = 192.168.4.1
upload_protocol = espota
upload_flags = --auth=11111111
build_flags = ${env.build_flags} -Wall -Os